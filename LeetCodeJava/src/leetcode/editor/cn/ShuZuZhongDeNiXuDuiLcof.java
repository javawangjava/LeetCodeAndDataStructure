/**
 * <p>åœ¨æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ•°å­—ï¼Œå¦‚æœå‰é¢ä¸€ä¸ªæ•°å­—å¤§äºåé¢çš„æ•°å­—ï¼Œåˆ™è¿™ä¸¤ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªé€†åºå¯¹ã€‚è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ±‚å‡ºè¿™ä¸ªæ•°ç»„ä¸­çš„é€†åºå¯¹çš„æ€»æ•°ã€‚</p>
 *
 * <p>&nbsp;</p>
 *
 * <p><strong>ç¤ºä¾‹ 1:</strong></p>
 *
 * <pre><strong>è¾“å…¥</strong>: [7,5,6,4]
 * <strong>è¾“å‡º</strong>: 5</pre>
 *
 * <p>&nbsp;</p>
 *
 * <p><strong>é™åˆ¶ï¼š</strong></p>
 *
 * <p><code>0 &lt;= æ•°ç»„é•¿åº¦ &lt;= 50000</code></p>
 * <div><div>Related Topics</div><div><li>æ ‘çŠ¶æ•°ç»„</li><li>çº¿æ®µæ ‘</li><li>æ•°ç»„</li><li>äºŒåˆ†æŸ¥æ‰¾</li><li>åˆ†æ²»</li><li>æœ‰åºé›†åˆ</li><li
 * >å½’å¹¶æ’åº</li></div></div><br><div><li>ğŸ‘ 797</li><li>ğŸ‘ 0</li></div>
 */

package leetcode.editor.cn;

/**
 * å‰‘æŒ‡ Offer 51
 * æ•°ç»„ä¸­çš„é€†åºå¯¹
 *
 * @author wangweizhou
 * @date 2022-07-20 09:17:04
 */

public class ShuZuZhongDeNiXuDuiLcof {

    public static void main(String[] args) {
        //æµ‹è¯•ä»£ç 
        Solution solution = new ShuZuZhongDeNiXuDuiLcof().new Solution();
    }

    //leetcode submit region begin(Prohibit modification and deletion)
    class Solution {


        // ã€Œå½’å¹¶æ’åºã€ä¸ã€Œé€†åºå¯¹ã€æ˜¯æ¯æ¯ç›¸å…³çš„ã€‚å½’å¹¶æ’åºä½“ç°äº† â€œåˆ†è€Œæ²»ä¹‹â€ çš„ç®—æ³•æ€æƒ³ï¼Œå…·ä½“ä¸ºï¼š
        //åˆ†ï¼š ä¸æ–­å°†æ•°ç»„ä»ä¸­ç‚¹ä½ç½®åˆ’åˆ†å¼€ï¼ˆå³äºŒåˆ†æ³•ï¼‰ï¼Œå°†æ•´ä¸ªæ•°ç»„çš„æ’åºé—®é¢˜è½¬åŒ–ä¸ºå­æ•°ç»„çš„æ’åºé—®é¢˜ï¼›
        //æ²»ï¼š åˆ’åˆ†åˆ°å­æ•°ç»„é•¿åº¦ä¸º 1 æ—¶ï¼Œå¼€å§‹å‘ä¸Šåˆå¹¶ï¼Œä¸æ–­å°† è¾ƒçŸ­æ’åºæ•°ç»„ åˆå¹¶ä¸º è¾ƒé•¿æ’åºæ•°ç»„ï¼Œç›´è‡³åˆå¹¶è‡³åŸæ•°ç»„æ—¶å®Œæˆæ’åºï¼›
        //åˆå¹¶é˜¶æ®µ æœ¬è´¨ä¸Šæ˜¯ åˆå¹¶ä¸¤ä¸ªæ’åºæ•°ç»„ çš„è¿‡ç¨‹ï¼Œè€Œæ¯å½“é‡åˆ° å·¦å­æ•°ç»„å½“å‰å…ƒç´  > å³å­æ•°ç»„å½“å‰å…ƒç´  æ—¶ï¼Œæ„å‘³ç€ ã€Œå·¦å­æ•°ç»„å½“å‰å…ƒç´  è‡³ æœ«å°¾å…ƒç´ ã€ ä¸ ã€Œå³å­æ•°ç»„å½“å‰å…ƒç´ ã€ æ„æˆäº†è‹¥å¹² ã€Œé€†åºå¯¹ã€ ã€‚


        // merge_sort() å½’å¹¶æ’åºä¸é€†åºå¯¹ç»Ÿè®¡ï¼š
        //ç»ˆæ­¢æ¡ä»¶ï¼š å½“ lâ‰¥r æ—¶ï¼Œä»£è¡¨å­æ•°ç»„é•¿åº¦ä¸º 1 ï¼Œæ­¤æ—¶ç»ˆæ­¢åˆ’åˆ†ï¼›
        //é€’å½’åˆ’åˆ†ï¼š è®¡ç®—æ•°ç»„ä¸­ç‚¹ m ï¼Œé€’å½’åˆ’åˆ†å·¦å­æ•°ç»„ merge_sort(l, m) å’Œå³å­æ•°ç»„ merge_sort(m + 1, r) ï¼›
        //åˆå¹¶ä¸é€†åºå¯¹ç»Ÿè®¡ï¼š
        //æš‚å­˜æ•°ç»„ nums é—­åŒºé—´ [i,r] å†…çš„å…ƒç´ è‡³è¾…åŠ©æ•°ç»„ tmp ï¼›
        //å¾ªç¯åˆå¹¶ï¼š è®¾ç½®åŒæŒ‡é’ˆ i , j åˆ†åˆ«æŒ‡å‘å·¦ / å³å­æ•°ç»„çš„é¦–å…ƒç´ ï¼›
        //å½“ i=m+1 æ—¶ï¼š ä»£è¡¨å·¦å­æ•°ç»„å·²åˆå¹¶å®Œï¼Œå› æ­¤æ·»åŠ å³å­æ•°ç»„å½“å‰å…ƒç´  tmp[j] ï¼Œå¹¶æ‰§è¡Œ j=j+1 ï¼›
        //å¦åˆ™ï¼Œå½“ j=r+1 æ—¶ï¼š ä»£è¡¨å³å­æ•°ç»„å·²åˆå¹¶å®Œï¼Œå› æ­¤æ·»åŠ å·¦å­æ•°ç»„å½“å‰å…ƒç´  tmp[i] ï¼Œå¹¶æ‰§è¡Œ i=i+1 ï¼›
        //å¦åˆ™ï¼Œå½“ tmp[i]â‰¤tmp[j] æ—¶ï¼š æ·»åŠ å·¦å­æ•°ç»„å½“å‰å…ƒç´  tmp[i] ï¼Œå¹¶æ‰§è¡Œ i=i+1ï¼›
        //å¦åˆ™ï¼ˆå³ tmp[i]>tmp[j]ï¼‰æ—¶ï¼š æ·»åŠ å³å­æ•°ç»„å½“å‰å…ƒç´  tmp[j] ï¼Œå¹¶æ‰§è¡Œ j=j+1 ï¼›æ­¤æ—¶æ„æˆ mâˆ’i+1ä¸ªã€Œé€†åºå¯¹ã€ï¼Œç»Ÿè®¡æ·»åŠ è‡³ resres ï¼›
        //è¿”å›å€¼ï¼š è¿”å›ç›´è‡³ç›®å‰çš„é€†åºå¯¹æ€»æ•° resres ï¼›

        //reversePairs() ä¸»å‡½æ•°ï¼š
        //åˆå§‹åŒ–ï¼š è¾…åŠ©æ•°ç»„ tmp ï¼Œç”¨äºåˆå¹¶é˜¶æ®µæš‚å­˜å…ƒç´ ï¼›
        //è¿”å›å€¼ï¼š æ‰§è¡Œå½’å¹¶æ’åº merge_sort() ï¼Œå¹¶è¿”å›é€†åºå¯¹æ€»æ•°å³å¯ï¼›


        // è§£æ³•2ï¼šå½’å¹¶æ’åº
        // åˆ©ç”¨å½’å¹¶æ’åºè§£ç­”ï¼Œåœ¨åˆå¹¶çš„æ—¶å€™ï¼Œå½“å·¦è¾¹çš„å¤§äºå³è¾¹ï¼Œå°±è®¡ç®—é€†åºæ•°ã€‚
        // è®¡ç®—å…¬å¼ï¼› mid-left+1
        // å®šä¹‰ä¸€ä¸ªå…¨å±€çš„è®¡æ•°å™¨å˜é‡

        //int count;// å…¨å±€å˜é‡    //å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè®°ä¸‹æ¯æ¬¡åˆå¹¶ä¸­å­˜åœ¨çš„é€†åºæ•°ã€‚
        //public int reversePairs(int[] nums) {
        //    if (nums == null || nums.length == 0) {//
        //        return 0;
        //    }
        //    count = 0;// é€†åºå¯¹æ•°
        //    mergeSort(nums, 0, nums.length - 1);
        //    return count;
        //}
        //
        //
        //// å½’å¹¶æ’åº
        //private void mergeSort(int[] nums, int left, int right) {
        //    //å½“åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œç›´æ¥è¿”å›ï¼Œé€€å‡ºé€’å½’
        //    if (nums == null || nums.length == 0 || left >= right) {
        //        return;
        //    }
        //    int mid = (left + right) / 2;
        //    mergeSort(nums, left, mid);// å¯¹å·¦ä¾§å­åºåˆ—è¿›è¡Œé€’å½’æ’åº
        //    mergeSort(nums, mid + 1, right);// å¯¹å³ä¾§å­åºåˆ—è¿›è¡Œé€’å½’æ’åº
        //    merge(nums, left, mid, right);// åˆå¹¶ä¸¤ä¸ªæœ‰åºåºåˆ—
        //}
        //
        //
        //// åˆå¹¶
        //private void merge(int[] nums, int left, int mid, int right) {
        //    if (nums == null || nums.length == 0) {
        //        return;
        //    }
        //    int[] temp = new int[right - left + 1];// å®šä¹‰ä¸€ä¸ªä¸´æ—¶æ•°ç»„æ¥ä¿å­˜åˆå¹¶åçš„æ•°ç»„
        //    int index = 0;// å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆindex ï¼ŒæŒ‡å‘ä¸´æ—¶æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚indexå…¶å®å°±æ˜¯åˆå¹¶åæ•°ç»„çš„éå†æŒ‡é’ˆ
        //    int p1 = left;// å·¦ä¾§å­åºåˆ—éå†æŒ‡é’ˆ
        //    int p2 = mid + 1;// å³ä¾§å­åºåˆ—éå†æŒ‡é’ˆ
        //    // åˆå¹¶ä¸¤ä¸ªæ’åºæ•°ç»„çš„æ€è·¯
        //    while (p1 <= mid && p2 <= right) {// å½“ä¸¤ä¸ªå­æ•°ç»„éƒ½æœ‰å…ƒç´ çš„æ—¶å€™ï¼Œéå†æ¯”è¾ƒæ¯ä¸ªå…ƒç´ å¤§å°
        //        // åˆå¹¶ï¼šåˆå¹¶ä¸¤ä¸ªå·²æ’åºå­åºåˆ—å¾—åˆ°æ’åºç»“æœã€‚
        //        if (nums[p1] <= nums[p2]) {// æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„çš„å…ƒç´ ï¼Œå–è¾ƒå°çš„å…ƒç´ åŠ å…¥åˆ°ä¸´æ—¶æ•°ç»„ä¸­ï¼Œå¹¶å°†ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ 
        //            temp[index++] = nums[p1++];
        //        } else {// nums[p1] > nums[p2]
        //            temp[index++] = nums[p2++];
        //            // å› ä¸ºå½’å¹¶æ’åºæ˜¯åˆå¹¶ä¸¤ä¸ªæœ‰åºå­åºåˆ—ï¼Œ
        //            // é‚£ä¹ˆè‹¥å·¦è¾¹æ•°ç»„çš„æŸä¸€ä¸ªå…ƒç´ nums[p1]å¤§äºå³è¾¹æ•°ç»„çš„æŸä¸€ä¸ªå…ƒç´ nums[p2]ï¼Œé‚£ä¹ˆå·¦è¾¹æ•°ç»„è¯¥å…ƒç´ nums[p1]åé¢çš„å…ƒç´ éƒ½å’Œå³è¾¹æ•°ç»„çš„å…ƒç´ nums[p2]æ„æˆé€†åºã€‚
        //            // åˆ™è¿™æ—¶å€™çš„é€†åºæ•°ä¸ºï¼ˆmid - p1 + 1ï¼‰ã€‚å·¦è¾¹nums[p1]åŠåé¢çš„å…ƒç´ ï¼š[p1,mid]
        //            //å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè®°ä¸‹æ¯æ¬¡åˆå¹¶ä¸­å­˜åœ¨çš„é€†åºæ•°ã€‚
        //            count += mid - p1 + 1;
        //        }
        //    }
        //    // ä¸Šé¢å¾ªç¯æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå­åºåˆ—å·²ç»éå†å®Œäº†ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ä¸¤ä¸ªå¾ªç¯æœ€å¤šåªæ‰§è¡Œä¸€ä¸ªã€‚
        //    // é‚£ä¹ˆå°±éœ€è¦å°†å‰©ä½™çš„å…ƒç´ æ·»åŠ åˆ°ä¿å­˜åˆå¹¶ååºåˆ—çš„æ•°ç»„ä¸­
        //    while (p1 <= mid) {//å½“å·¦è¾¹çš„æ•°ç»„æ²¡æœ‰éå†å®Œæˆæ—¶ï¼Œç›´æ¥å°†å‰©ä½™å…ƒç´ åŠ å…¥åˆ°ä¸´æ—¶æ•°ç»„ä¸­
        //        temp[index++] = nums[p1++];
        //    }
        //    while (p2 <= right) {//å½“å³è¾¹çš„æ•°ç»„æ²¡æœ‰éå†å®Œæˆæ—¶ï¼Œç›´æ¥å°†å‰©ä½™å…ƒç´ åŠ å…¥åˆ°ä¸´æ—¶æ•°ç»„ä¸­
        //        temp[index++] = nums[p2++];
        //    }
        //    //å°†æ–°æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè¦†ç›–numsæ—§æ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„å…ƒç´ ã€‚
        //    //æ­¤æ—¶æ•°ç»„çš„å…ƒç´ å·²ç»æ˜¯æœ‰åºçš„
        //    for (int k = 0; k < temp.length; k++) {
        //        nums[left + k] = temp[k];
        //    }
        //}



        // è§£æ³•2ï¼šå½’å¹¶æ’åº  å†™æ³•2 è¿™é‡Œä½¿ç”¨åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„æ¥ä¼ é€’å‚æ•°
        public int reversePairs(int[] nums) {
            if (nums == null || nums.length == 0) {
                return 0;
            }
            int[] counts = new int[1];
            mergesort(nums, 0, nums.length - 1, counts);
            return counts[0];
        }


        private void mergesort(int[] nums, int left, int right, int[] counts) {
            if (nums == null || nums.length == 0 || left >= right) {
                return;
            }
            int mid = (left + right) >> 1;
            mergesort(nums, left, mid, counts);
            mergesort(nums, mid + 1, right, counts);
            merge(nums, left, mid, right, counts);
        }


        private void merge(int[] nums, int left, int mid, int right, int[] counts) {
            int[] temp = new int[right - left + 1];
            int index = 0;
            int p1 = left;
            int p2 = mid + 1;
            while (p1 <= mid && p2 <= right) {
                if (nums[p1] <= nums[p2]) {
                    temp[index] = nums[p1];
                    index++;
                    p1++;
                } else {
                    temp[index] = nums[p2];
                    index++;
                    p2++;
                    counts[0] += mid - p1 + 1;
                }
            }

            while (p1 <= mid) {
                temp[index] = nums[p1];
                index++;
                p1++;
            }
            while (p2 <= right) {
                temp[index] = nums[p2];
                index++;
                p2++;
            }

            for (int i = 0; i < temp.length; i++) {
                nums[left + i] = temp[i];
            }
        }


        //// æ–¹æ³•1ï¼šæš´åŠ›å¾ªç¯è¶…æ—¶äº†
        //public int reversePairs(int[] nums) {
        //
        //	if(nums==null){
        //		return 0;
        //	}
        //	int length=nums.length;
        //	int count=0;
        //	for (int i = 0; i < length; i++) {
        //		for (int j = i+1; j <length ; j++) {
        //			if(nums[i]>nums[j]){
        //				count++;
        //			}
        //		}
        //	}
        //	return count;
        //}


    }
//leetcode submit region end(Prohibit modification and deletion)

}
